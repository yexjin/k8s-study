# Service μ •λ¦¬

π”—Β [μ°Έκ³ λ§ν¬](https://kubernetes.io/ko/docs/concepts/services-networking/service/)

### Service

---

- ν΄λΌμ΄μ–ΈνΈκ°€ **νλ“λ¥Ό κ²€μƒ‰ν•κ³  ν†µμ‹ μ„ κ°€λ¥**ν•κ² ν•λ‹¤.
- νλ“λ” μ–Έμ λ“ μ§€ ν΄λ¬μ¤ν„° μ•μ—μ„ μ΄λ™ν•  μ μμ–΄μ„ IP μ£Όμ†κ°€ λ³€κ²½λ  μ μλ”λ°, μ΄λ° κ²½μ° ν•΄λ‹Ή νλ“μ— λ€ν• μ„λΉ„μ¤λ¥Ό λ§λ“¤κ³  ν΄λ¬μ¤ν„° μ™Έλ¶€μ—μ„ μ•΅μ„Έμ¤ν•  μ μλ„λ΅ κµ¬μ„±ν•λ©΄ μ™Έλ¶€ ν΄λΌμ΄μ–ΈνΈκ°€ νλ“μ— μ—°κ²°ν•  μ μλ” ν•λ‚μ **κ³ μ • IP μ£Όμ†**κ°€ λ…Έμ¶λλ‹¤.
- μ™Έλ¶€ λΏλ§ μ•„λ‹λΌ λ‚΄λ¶€ ν΄λΌμ΄μ–ΈνΈλ„ μ„λΉ„μ¤λ΅ νλ“ μ ‘κ·Ό κ°€λ¥

`Label Selector` : μ–΄λ–¤ νλ“κ°€ μ„λΉ„μ¤μ— μ†ν•λ”μ§€ μ •ν•¨

<br>

### Service λ§λ“¤κΈ°

---

kubia-nginx-pod.yaml

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: kubia-nginx-pod
  labels:
    app.kubernetes.io/name: proxy
spec:
  containers:
    - name: nginx
      image: nginx:stable
      ports:
        - containerPort: 80
          name: http-web-svc
```

kubia-nginx-svc.yaml

```yaml
apiVersion: v1
kind: Service
metadata:
  name: kubia-nginx-svc
spec:
  selector:
    app.kubernetes.io/name: proxy
  ports:
    - name: name-of-service-port
      protocol: TCP
      port: 80
      targetPort: http-web-svc
```

μ„λΉ„μ¤μ— λ‚΄λ¶€ ν΄λ¬μ¤ν„° IPκ°€ ν• λ‹Ήλλ”μ§€ ν™•μΈ

```bash
kubectl --kubeconfig kubeconfig-lena-cluster.yaml get svc

# OUTPUT
NAME         TYPE           CLUSTER-IP      EXTERNAL-IP      PORT(S)        AGE
kubernetes   ClusterIP      10.96.0.1       <none>           443/TCP        26d
kubia        ClusterIP      10.97.162.150   <none>           80/TCP         46s
```

ClusterIP νƒ€μ…μ΄λ―€λ΅ ν΄λ¬μ¤ν„° λ‚΄λ¶€μ—μ„λ§ μ•΅μ„Έμ¤ ν•  μ μλ‹¤

<br>

### Service Endpoint

---

```bash
kubectl --kubeconfig kubeconfig-lena-cluster.yaml describe service kubia-nginx-svc

# OUTPUT
Name:              kubia-nginx-svc
Namespace:         default
Labels:            <none>
Annotations:       <none>
Selector:          app.kubernetes.io/name=proxy   # Serviceμ Pod selectorλ” μ—”λ“ν¬μΈνΈ λ©λ΅μ„ λ§λ“λ”λ° μ‚¬μ©λλ‹¤.
Type:              ClusterIP
IP Family Policy:  SingleStack
IP Families:       IPv4
IP:                10.108.126.164
IPs:               10.108.126.164
Port:              name-of-service-port  80/TCP
TargetPort:        http-web-svc/TCP
Endpoints:         192.168.163.200:80     # μ΄ μ„λΉ„μ¤μ μ—”λ“ν¬μΈνΈλ¥Ό λ‚νƒ€λ‚΄λ” νλ“ IPμ™€ ν¬νΈ λ©λ΅
Session Affinity:  None
Events:            <none>
```

β†’ Pod Selector μ—†μ΄ μ„λΉ„μ¤λ¥Ό λ§λ“¤λ©΄ μΏ λ²„λ„¤ν‹°μ¤λ” μ—”λ“ν¬μΈνΈ λ¦¬μ†μ¤λ¥Ό λ§λ“¤μ§€ λ»ν•λ‹¤. (μ„λΉ„μ¤μ— ν¬ν•¨λ νλ“κ°€ λ¬΄μ—‡μΈμ§€ μ• μ μ—†μ–΄μ„)

<br>

### ν΄λ¬μ¤ν„° μ™Έλ¶€μ— μλ” μ„λΉ„μ¤ μ—°κ²° (μ™Έλ¶€ β†’ λ‚΄λ¶€)

---

Selectorκ°€ μ—†λ” μ™Έλ¶€ μ„λΉ„μ¤λ” μ—”λ“ν¬μΈνΈ λ¦¬μ†μ¤κ°€ μλ™μΌλ΅ μƒμ„±λμ§€ μ•μΌλ―€λ΅, μ—”λ“ν¬μΈνΈ μ„λΉ„μ¤λ¥Ό μλ™ μƒμ„±ν•΄μ•Όν•λ‹¤.

β†’ μ—”λ“ν¬μΈνΈ μ¤λΈμ νΈλ” μ„λΉ„μ¤μ™€ μ΄λ¦„μ΄ κ°™μ•„μ•Ό ν•κ³  μ„λΉ„μ¤λ¥Ό μ κ³µν•λ” λ€μƒ IP μ£Όμ†μ™€ ν¬νΈ λ©λ΅μ„ κ°€μ Έμ•Ό ν•λ‹¤.

<br>

### μ™Έλ¶€ ν΄λΌμ΄μ–ΈνΈμ— μ„λΉ„μ¤ λ…Έμ¶ (λ‚΄λ¶€ β†’ μ™Έλ¶€)

---

λ…Έμ¶ λ°©λ²•

1. λ…Έλ“ν¬νΈλ΅ μ„λΉ„μ¤ μ ν• μ„¤μ •
2. μ„λΉ„μ¤ μ ν•μ„ λ…Έλ“ν¬νΈ μ ν•μ ν™•μ¥μΈ λ΅λ“λ°Έλ°μ„λ΅ μ„¤μ •
3. λ‹¨μΌ IP μ£Όμ†λ΅ μ—¬λ¬ μ„λΉ„μ¤λ¥Ό λ…Έμ¶ν•λ” μΈκ·Έλ μ¤ λ¦¬μ†μ¤ λ§λ“¤κΈ°

<br>

### μ”μ•½

---

κ° μ„λΉ„μ¤λ¥Ό μ κ³µν•λ” νλ“ μΈμ¤ν„΄μ¤ μμ— κ΄€κ³„ μ—†μ΄ μΏ λ²„λ„¤ν‹°μ¤ μ„λΉ„μ¤ λ¦¬μ†μ¤λ¥Ό μƒμ„±ν•΄ μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ μ‚¬μ©κ°€λ¥ν• μ„λΉ„μ¤λ¥Ό λ…Έμ¶ν•λ” λ°©λ²•μ„ μ•μ•„λ΄¤λ‹¤.

1. μ•μ •λ λ‹¨μΌ IP μ£Όμ†μ™€ ν¬νΈλ΅ νΉμ • λ μ΄λΈ” μ…€λ ‰ν„°μ™€ μΌμΉν•λ” μ—¬λ¬ κ°μ νλ“λ¥Ό λ…Έμ¶ν•λ‹¤.
2. κΈ°λ³Έμ μΌλ΅ ν΄λ¬μ¤ν„° λ‚΄λ¶€μ—μ„ μ„λΉ„μ¤μ— μ•΅μ„Έμ¤ν•  μ μμ§€λ§ μ ν•μ„ λ…Έλ“ν¬νΈ λλ” λ΅λ“λ²¨λ°μ„λ΅ μ„¤μ •ν•΄ ν΄λ¬μ¤ν„° μ™Έλ¶€μ—μ„ μ„λΉ„μ¤μ— μ•΅μ„Έμ¤ ν•  μ μλ‹¤.
3. νλ“κ°€ ν™κ²½λ³€μλ¥Ό κ²€μƒ‰ν•΄ IP μ£Όμ†μ™€ ν¬νΈλ΅ μ„λΉ„μ¤λ¥Ό κ²€μƒ‰ν•  μ μλ‹¤. `ν•™μµX`
4. κ΄€λ ¨λ μ—”λ“ν¬μΈνΈ λ¦¬μ†μ¤λ¥Ό λ§λ“λ” λ€μ‹  μ…€λ ‰ν„° μ„¤μ • μ—†μ΄ μ„λΉ„μ¤ λ¦¬μ†μ¤λ¥Ό μƒμ„±ν•΄ ν΄λ¬μ¤ν„° μ™Έλ¶€μ— μλ” μ„λΉ„μ¤λ¥Ό κ²€μƒ‰ν•κ³  ν†µμ‹ ν•  μ μλ‹¤.
5. ExternalName μ„λΉ„μ¤ μ ν•μΌλ΅ μ™Έλ¶€ μ„λΉ„μ¤μ— λ€ν• DNS CNAME λ³„μΉ­μ„ μ κ³µν•λ‹¤. `ν•™μµX`
6. λ‹¨μΌ μΈκ·Έλ μ¤λ΅ μ—¬λ¬ HTTP μ„λΉ„μ¤λ¥Ό λ…Έμ¶ν•λ‹¤ (λ‹¨μΌ μΈκ·Έλ μ¤ μ»¨νΈλ΅¤λ¬ IP μ‚¬μ©) `ν•™μµX`
7. νλ“ μ»¨ν…μ΄λ„μ λ λ””λ‹μ¤ ν”„λ΅λΈλ” νλ“λ¥Ό μ„λΉ„μ¤ μ—”λ“ν¬μΈνΈμ— ν¬ν•¨ν•΄μ•Όν•λ”μ§€ μ—¬λ¶€λ¥Ό κ²°μ •ν•λ‹¤. `ν•™μµX`
8. ν—¤λ“λ¦¬μ¤ μ„λΉ„μ¤λ¥Ό μƒμ„±ν•λ©΄ DNSλ΅ νλ“ IPλ¥Ό κ²€μƒ‰ν•  μ μλ‹¤. `ν•™μµX`
